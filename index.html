<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nikhil Player</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #050505; color: white; font-family: sans-serif; }
        .folder-card { background: #0f0f0f; border: 1px solid #1a1a1a; border-radius: 24px; transition: 0.3s; cursor: pointer; }
        .folder-card:active { transform: scale(0.95); }
        .hdr-boost { filter: brightness(1.5) contrast(1.2) saturate(1.1); }
    </style>
</head>
<body class="p-5 pb-24">

    <header class="flex justify-between items-center mb-10">
        <div>
            <h1 class="text-3xl font-black text-pink-500 italic tracking-tighter uppercase">Nikhil Player</h1>
            <p class="text-[9px] font-bold text-zinc-500 uppercase tracking-widest mt-1">Local Storage â€¢ Offline</p>
        </div>
        <div class="w-10 h-10 rounded-full bg-zinc-900 border border-zinc-800 flex items-center justify-center text-xl">âš¡</div>
    </header>

    <div id="folderGrid" class="grid grid-cols-2 gap-4">
        <div onclick="openFolder('Reels')" class="folder-card p-8 text-center">
            <span class="text-4xl">ğŸ“±</span>
            <p class="mt-3 text-[10px] font-black uppercase tracking-widest">Reels</p>
        </div>
        <div onclick="openFolder('Videos')" class="folder-card p-8 text-center">
            <span class="text-4xl">ğŸ¬</span>
            <p class="mt-3 text-[10px] font-black uppercase tracking-widest">Videos</p>
        </div>
        <div onclick="openFolder('Movies')" class="folder-card p-8 text-center">
            <span class="text-4xl">ğŸ¿</span>
            <p class="mt-3 text-[10px] font-black uppercase tracking-widest">Movies</p>
        </div>
        <div onclick="openFolder('Private')" class="folder-card p-8 text-center">
            <span class="text-4xl">ğŸ”’</span>
            <p class="mt-3 text-[10px] font-black uppercase tracking-widest">Private</p>
        </div>
        <div onclick="openFolder('Images')" class="folder-card p-8 text-center col-span-2">
            <span class="text-4xl">ğŸ“¸</span>
            <p class="mt-3 text-[10px] font-black uppercase tracking-widest">Image Overlay Store</p>
        </div>
    </div>

    <div id="folderDetail" class="hidden">
        <div class="flex items-center gap-4 mb-8">
            <button onclick="backToFolders()" class="text-pink-500 font-bold">â† BACK</button>
            <h2 id="folderTitle" class="text-xl font-black uppercase"></h2>
        </div>
        
        <div class="flex gap-2 mb-8">
            <input type="file" id="fileInp" class="hidden" multiple onchange="handleFiles(this)">
            <button onclick="document.getElementById('fileInp').click()" class="flex-1 bg-white text-black font-black py-4 rounded-2xl text-[10px] uppercase shadow-lg">Add Media</button>
            <button onclick="clearCurrentFolder()" class="bg-zinc-900 text-red-500 font-bold px-4 rounded-2xl text-[10px] border border-zinc-800 uppercase">Clear</button>
        </div>

        <div id="mediaList" class="space-y-4"></div>
    </div>

    <div id="playerOverlay" class="fixed bottom-6 right-6 w-48 z-50 hidden bg-black border border-zinc-800 rounded-2xl overflow-hidden shadow-2xl">
        <video id="pipVideo" class="hdr-boost" playsinline controls></video>
        <div class="p-2 flex justify-between bg-zinc-900">
            <button onclick="requestPiP()" class="text-[8px] font-bold text-pink-500 uppercase">Floating Mode</button>
            <button onclick="closePlayer()" class="text-[8px] font-bold text-zinc-500 uppercase">Close</button>
        </div>
    </div>

    <script>
        let db;
        let currentFolder = '';
        const req = indexedDB.open("NikhilPlayerDB", 2);
        
        req.onupgradeneeded = e => {
            const d = e.target.result;
            if(!d.objectStoreNames.contains("media")) d.createObjectStore("media", { keyPath: "id" });
        };
        
        req.onsuccess = e => { db = e.target.result; };

        function openFolder(name) {
            currentFolder = name;
            document.getElementById('folderGrid').classList.add('hidden');
            document.getElementById('folderDetail').classList.remove('hidden');
            document.getElementById('folderTitle').innerText = name;
            loadFromDB();
        }

        function backToFolders() {
            document.getElementById('folderGrid').classList.remove('hidden');
            document.getElementById('folderDetail').classList.add('hidden');
        }

        function handleFiles(input) {
            const files = Array.from(input.files);
            files.forEach(file => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => {
                    const tx = db.transaction("media", "readwrite");
                    tx.objectStore("media").add({
                        id: Date.now() + Math.random(),
                        folder: currentFolder,
                        name: file.name,
                        data: reader.result,
                        type: file.type
                    });
                    tx.oncomplete = loadFromDB;
                };
            });
        }

        function loadFromDB() {
            const list = document.getElementById('mediaList');
            list.innerHTML = '';
            db.transaction("media").objectStore("media").getAll().onsuccess = e => {
                const results = e.target.result.filter(m => m.folder === currentFolder);
                if(results.length === 0) list.innerHTML = '<p class="text-center text-zinc-700 py-10 text-xs">Folder Empty</p>';
                results.forEach(item => {
                    const div = document.createElement('div');
                    div.className = "folder-card p-5 flex justify-between items-center";
                    div.innerHTML = `<span class="text-[10px] font-bold truncate w-40">${item.name}</span>
                                     <button onclick="playMedia('${item.data}')" class="text-pink-500 font-black text-[10px] uppercase">Play</button>`;
                    list.appendChild(div);
                });
            };
        }

        function playMedia(url) {
            const v = document.getElementById('pipVideo');
            v.src = url;
            document.getElementById('playerOverlay').classList.remove('hidden');
            v.play();
        }

        async function requestPiP() {
            try { await document.getElementById('pipVideo').requestPictureInPicture(); } catch(e) {}
        }

        function closePlayer() {
            const v = document.getElementById('pipVideo');
            v.pause();
            document.getElementById('playerOverlay').classList.add('hidden');
        }

        function clearCurrentFolder() {
            if(confirm("Ee folder lo data motham erase cheyala mama?")) {
                const tx = db.transaction("media", "readwrite");
                const store = tx.objectStore("media");
                store.getAll().onsuccess = e => {
                    e.target.result.filter(m => m.folder === currentFolder).forEach(item => store.delete(item.id));
                    tx.oncomplete = loadFromDB;
                };
            }
        }
    </script>
</body>
</html>
